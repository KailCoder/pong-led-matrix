<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700" viewBox="0 0 1200 700">
  <style>
    .box { fill:#ffffff; stroke:#333; stroke-width:1.6; rx:6; }
    .chip { fill:#eef6ff; stroke:#1e6fb3; stroke-width:2; rx:6; }
    .label { font: 13px/1.2 sans-serif; fill:#102a43; }
    .pin { font: 12px monospace; fill:#123; }
    .line { stroke:#0b3d91; stroke-width:2; marker-end:url(#arr); }
    .small { font: 11px sans-serif; fill:#123; }
  </style>
  <defs>
    <marker id="arr" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#0b3d91"/>
    </marker>
  </defs>

  <!-- Fast clock -->
  <rect x="40" y="30" width="200" height="70" class="chip"/>
  <text x="140" y="60" text-anchor="middle" class="label">ClockGenerator</text>
  <text x="140" y="80" text-anchor="middle" class="small">fast (ej. 2 kHz)</text>

  <!-- 74HC161 scan counter -->
  <rect x="280" y="30" width="220" height="120" class="chip"/>
  <text x="390" y="55" text-anchor="middle" class="label">74HC161 (scan counter)</text>
  <text x="390" y="76" text-anchor="middle" class="small">CLK, Q0..Q3, ENT/ENP, CLR</text>
  <text x="320" y="100" class="pin">CLK → pin</text>

  <!-- 74HC138 decoder -->
  <rect x="560" y="30" width="200" height="120" class="chip"/>
  <text x="660" y="55" text-anchor="middle" class="label">74HC138 (3→8)</text>
  <text x="660" y="76" text-anchor="middle" class="small">A,B,C ← Q0..Q2 of 74HC161</text>

  <!-- connection Clock -> 74HC161 -->
  <line x1="240" y1="65" x2="280" y2="65" class="line"/>
  <text x="260" y="55" class="small">fast clock</text>

  <!-- Q0..Q2 to decoder -->
  <line x1="500" y1="80" x2="560" y2="80" class="line"/>
  <text x="530" y="70" class="small">Q0..Q2</text>

  <!-- 74HC595 block -->
  <rect x="280" y="200" width="480" height="160" class="chip"/>
  <text x="520" y="230" text-anchor="middle" class="label">2 × 74HC595 (Column drivers)</text>
  <text x="520" y="250" text-anchor="middle" class="small">SRCLK, RCLK, SER, OE, Q0..Q7</text>

  <!-- Column outputs -->
  <rect x="820" y="240" width="260" height="120" class="box"/>
  <text x="950" y="260" text-anchor="middle" class="label">Columns</text>
  <text x="950" y="280" text-anchor="middle" class="small">Q0..Q7 → via 330Ω → matrix columns</text>

  <!-- Row outputs -->
  <rect x="820" y="80" width="260" height="120" class="box"/>
  <text x="950" y="100" text-anchor="middle" class="label">Rows</text>
  <text x="950" y="120" text-anchor="middle" class="small">Y0..Y7 from 74HC138 → matrix rows</text>

  <!-- Lines: 74HC161 -> 74HC138 -> Rows -->
  <line x1="500" y1="120" x2="560" y2="120" class="line"/>
  <line x1="760" y1="120" x2="820" y2="120" class="line"/>
  <text x="680" y="110" class="small">Y0..Y7</text>

  <!-- Lines: 74HC595 -> Columns -->
  <line x1="640" y1="290" x2="820" y2="290" class="line"/>
  <text x="730" y="280" class="small">Q0..Q7 (2x595 concatenated)</text>

  <!-- Notes and key -->
  <rect x="40" y="400" width="1040" height="240" fill="#fffef6" stroke="#9f7a16" stroke-width="1" rx="6"/>
  <text x="60" y="430" class="label">Notas / prácticas</text>
  <text x="60" y="455" class="small">- SRCLK (shift) driven by fast clock; RCLK (latch) pulsed after column data stable</text>
  <text x="60" y="475" class="small">- OE should be tied low (enabled) or used to blank display during updates</text>
  <text x="60" y="495" class="small">- Para evitar glitches: actualizar RCLK entre filas (cuando la fila activa está inactiva)</text>
  <text x="60" y="515" class="small">- Tipo de matriz: si es ánodo común, rows = VCC drivers; si cátodo común, rows = sink</text>
  <text x="60" y="535" class="small">- pull-ups y resistencias LED: 330Ω recommended</text>
</svg>